{% extends 'base.html.twig' %}

{% block title %}{{ 'admin.comments'|trans }}{% endblock %}

{% block body %}
<section class="page-section">
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="page-header-content">
                <h1 class="page-title">
                    <i class="fas fa-shield-alt"></i>
                    {{ 'admin.comments'|trans }}
                </h1>
                <p class="page-subtitle">
                    {% if current_filter == 'pending' %}{{ 'comment.pending'|trans }}
                    {% elseif current_filter == 'approved' %}{{ 'comment.approved'|trans }}
                    {% else %}{{ 'comment.rejected'|trans }}
                    {% endif %}
                </p>
            </div>
            <a href="{{ path('admin_dashboard', {'_locale': app.request.locale}) }}" class="btn btn-outline-light">
                <i class="fas fa-arrow-left"></i>
                {{ 'admin.dashboard'|trans }}
            </a>
        </div>

        <!-- Filter Tabs -->
        <div class="category-filter-bar mb-4 justify-content-start">
            <a href="{{ path('admin_comments', {'_locale': app.request.locale, 'filter': 'pending'}) }}" 
               class="category-filter-btn {% if current_filter == 'pending' %}active{% endif %}">
                <span class="filter-icon">â³</span>
                <span class="filter-label">{{ 'comment.pending'|trans }}</span>
            </a>
            <a href="{{ path('admin_comments', {'_locale': app.request.locale, 'filter': 'approved'}) }}" 
               class="category-filter-btn {% if current_filter == 'approved' %}active{% endif %}">
                <span class="filter-icon">âœ…</span>
                <span class="filter-label">{{ 'comment.approved'|trans }}</span>
            </a>
            <a href="{{ path('admin_comments', {'_locale': app.request.locale, 'filter': 'rejected'}) }}" 
               class="category-filter-btn {% if current_filter == 'rejected' %}active{% endif %}">
                <span class="filter-icon">âŒ</span>
                <span class="filter-label">{{ 'comment.rejected'|trans }}</span>
            </a>
        </div>

        <!-- Flash Messages -->
        {% for message in app.flashes('success') %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fas fa-check-circle"></i>
                {{ message|trans }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}

        {% if comments is empty %}
            <div class="empty-state-card">
                <div class="empty-icon">
                    {% if current_filter == 'pending' %}âœ…
                    {% elseif current_filter == 'approved' %}ğŸ“­
                    {% else %}ğŸ—‘ï¸{% endif %}
                </div>
                <h3>No Comments Found</h3>
                <p>There are no {{ current_filter }} comments.</p>
            </div>
        {% else %}
            <div class="comments-moderation-grid">
                {% for comment in comments %}
                    <div class="moderation-card {{ current_filter }}">
                        <div class="moderation-header">
                            <div class="moderation-meta">
                                <span class="comment-id">#{{ comment.id }}</span>
                                {% if comment.isApproved is same as(true) %}
                                    <span class="status-badge approved">
                                        <i class="fas fa-check"></i> {{ 'comment.approved'|trans }}
                                    </span>
                                {% elseif comment.isApproved is same as(false) %}
                                    <span class="status-badge rejected" style="background: rgba(239, 68, 68, 0.2); color: #ef4444;">
                                        <i class="fas fa-times"></i> {{ 'comment.rejected'|trans }}
                                    </span>
                                {% else %}
                                    <span class="status-badge pending">
                                        <i class="fas fa-clock"></i> {{ 'comment.pending'|trans }}
                                    </span>
                                {% endif %}
                            </div>
                            <small class="comment-date">{{ comment.createdAt|date('d M Y, H:i') }}</small>
                        </div>
                        
                        <div class="moderation-body">
                            <div class="comment-author-info">
                                <i class="fas fa-user-circle"></i>
                                <span>{{ comment.author.email }}</span>
                            </div>
                            <p class="comment-content-preview">{{ comment.content }}</p>
                            <div class="comment-article-info">
                                <i class="fas fa-newspaper"></i>
                                <span>{{ comment.article.title }}</span>
                            </div>
                        </div>
                        
                        <div class="moderation-actions">
                            {% if current_filter != 'approved' %}
                                <a href="{{ path('admin_comment_approve', {id: comment.id, '_locale': app.request.locale}) }}" class="btn btn-success btn-sm">
                                    <i class="fas fa-check"></i>
                                    {{ 'comment.approve'|trans }}
                                </a>
                            {% endif %}
                            
                            {% if current_filter != 'rejected' %}
                                <a href="{{ path('admin_comment_reject', {id: comment.id, '_locale': app.request.locale}) }}" class="btn btn-warning btn-sm" style="background-color: #f59e0b; border-color: #f59e0b; color: white;">
                                    <i class="fas fa-ban"></i>
                                    {{ 'comment.reject'|trans }}
                                </a>
                            {% endif %}
                            
                            <a href="{{ path('admin_comment_delete', {id: comment.id, '_locale': app.request.locale}) }}" class="btn btn-danger btn-sm" onclick="return confirm('{{ 'msg.confirm_delete'|trans }}');">
                                <i class="fas fa-trash"></i>
                                {{ 'comment.delete'|trans }}
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}
