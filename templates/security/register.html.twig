{% extends 'base.html.twig' %}

{% block title %}{{ 'auth.register_title'|trans }}{% endblock %}

{% block body %}
<section class="auth-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-5">
                <div class="auth-card">
                    <div class="auth-header">
                        <div class="auth-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h1 class="auth-title">{{ 'auth.register_title'|trans }}</h1>
                    </div>

                    <div class="auth-body">
                        {{ form_start(registrationForm, {'attr': {'class': 'auth-form', 'novalidate': 'novalidate'}}) }}

                            <div class="form-group mb-4">
                                <label for="email" class="form-label">
                                    <i class="fas fa-envelope"></i>
                                    {{ 'auth.email'|trans }}
                                </label>
                                {{ form_widget(registrationForm.email, {'attr': {'class': 'form-control auth-input', 'placeholder': 'email@example.com'}}) }}
                                {% if registrationForm.email.vars.errors|length > 0 %}
                                    <div class="alert alert-danger mt-2">
                                        {% for error in registrationForm.email.vars.errors %}
                                            <div>{{ error.message }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="form-group mb-4">
                                <label for="password" class="form-label">
                                    <i class="fas fa-lock"></i>
                                    {{ 'auth.password'|trans }}
                                </label>
                                {{ form_widget(registrationForm.plainPassword.first, {'attr': {'class': 'form-control auth-input', 'id': 'password-input'}}) }}
                                
                                <!-- Password Strength Indicator -->
                                <div class="password-strength-container" id="password-strength-container" style="display: none;">
                                    <div class="password-strength-bar">
                                        <div class="password-strength-fill" id="password-strength-fill"></div>
                                    </div>
                                    <span class="password-strength-text" id="password-strength-text"></span>
                                    <p class="password-hint">{{ 'password.hint'|trans }}</p>
                                </div>
                                
                                {% if registrationForm.plainPassword.first.vars.errors|length > 0 %}
                                    <div class="alert alert-danger mt-2">
                                        {% for error in registrationForm.plainPassword.first.vars.errors %}
                                            <div>{{ error.message }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="form-group mb-4">
                                <label for="confirm-password" class="form-label">
                                    <i class="fas fa-lock"></i>
                                    {{ 'auth.confirm_password'|trans }}
                                </label>
                                {{ form_widget(registrationForm.plainPassword.second, {'attr': {'class': 'form-control auth-input'}}) }}
                                {% if registrationForm.plainPassword.second.vars.errors|length > 0 %}
                                    <div class="alert alert-danger mt-2">
                                        {% for error in registrationForm.plainPassword.second.vars.errors %}
                                            <div>{{ error.message }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            {{ form_errors(registrationForm) }}

                            <button class="btn btn-primary btn-auth w-100">
                                <i class="fas fa-user-plus"></i>
                                {{ 'auth.register_button'|trans }}
                            </button>

                        {{ form_end(registrationForm) }}

                        <div class="auth-footer">
                            <p>
                                {{ 'auth.already_have_account'|trans }} 
                                <a href="{{ path('app_login', {'_locale': app.request.locale}) }}" class="auth-link">
                                    {{ 'nav.login'|trans }}
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('password-input');
    const strengthContainer = document.getElementById('password-strength-container');
    const strengthFill = document.getElementById('password-strength-fill');
    const strengthText = document.getElementById('password-strength-text');
    
    const translations = {
        weak: "{{ 'password.weak'|trans }}",
        medium: "{{ 'password.medium'|trans }}",
        strong: "{{ 'password.strong'|trans }}",
        veryStrong: "{{ 'password.very_strong'|trans }}"
    };
    
    if (passwordInput) {
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            
            if (password.length === 0) {
                strengthContainer.style.display = 'none';
                return;
            }
            
            strengthContainer.style.display = 'block';
            
            // Calculate password strength
            let strength = 0;
            if (password.length >= 6) strength++;
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            // Update UI
            strengthFill.className = 'password-strength-fill';
            strengthText.className = 'password-strength-text';
            
            if (strength <= 2) {
                strengthFill.classList.add('strength-weak');
                strengthText.classList.add('weak');
                strengthText.textContent = translations.weak;
            } else if (strength <= 3) {
                strengthFill.classList.add('strength-medium');
                strengthText.classList.add('medium');
                strengthText.textContent = translations.medium;
            } else if (strength <= 4) {
                strengthFill.classList.add('strength-strong');
                strengthText.classList.add('strong');
                strengthText.textContent = translations.strong;
            } else {
                strengthFill.classList.add('strength-very-strong');
                strengthText.classList.add('very-strong');
                strengthText.textContent = translations.veryStrong;
            }
        });
    }
});
</script>
{% endblock %}
